generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
}

model User {
  id       String @id @unique
  name     String?
  email    String @unique
  password String?
  role     String
  avatar String?
  client_id String?
  is_manager Boolean?
  token    String?
  invited_at DateTime?
  activated_at DateTime?

  client Client? @relation(fields: [client_id], references: [id])
  chatsAsParticipant1 Chat[] @relation("participant1Chats")
  chatsAsParticipant2 Chat[] @relation("participant2Chats")

  notifications Notification[]
  userPreferences UserPreferences?
  messages Message[]
}

model Email {
  id       String @id @unique
  name     String
  from    String
  to String[]
  subject String
  html     String
  type String?
  replyed String?
  has_reply Boolean?
  created_at DateTime
}

model Client {
  id String @id @unique
  company String
  logotipo String?
  cpf String?
  cnpj String?

  users User[]
  projects Project[]
}

model Project {
  id String @id @unique
  client_id String?
	name String
	description String?
	status String?
  budget Float?
	due DateTime

  tasks Task[]
  client Client? @relation(fields: [client_id], references: [id])
}

model Task {
  id String @id @unique
  project_id String?
	name String
	description String?
	status String?
  startDate DateTime?
  endDate DateTime?

  project Project? @relation(fields: [project_id], references: [id])
}

model Notification {
  	id   String @id @unique
    user_id String
    type  String
    title  String
    description  String?
    link  String?
    read  Boolean
    created_at DateTime

    user User @relation(fields: [user_id], references: [id])
}

model UserPreferences {
  user_id String @id @unique
  email_notification Boolean
  console_notification Boolean

  user User @relation(fields: [user_id], references: [id])
}

model Chat {
	id String @id @unique 
	participant1_id String
	participant2_id String

  participant1 User @relation("participant1Chats", fields: [participant1_id], references: [id])
  participant2 User @relation("participant2Chats", fields: [participant2_id], references: [id])
  
  messages Message[]
}

model Message {
	id String @id @unique 
	chat_id String
	user_id String
	text String
	date DateTime?
	read Boolean?
	labels String[]

  chat Chat @relation(fields: [chat_id], references: [id])
  user User @relation(fields: [user_id], references: [id])
}